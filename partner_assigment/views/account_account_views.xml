<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Account Account Form View -->
    <record id="view_account_form_partner_assignment" model="ir.ui.view">
        <field name="name">account.account.form.partner.assignment</field>
        <field name="model">account.account</field>
        <field name="inherit_id" ref="account.view_account_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='tax_ids']" position="after">
                <field name="assigned_partner_ids" 
                       widget="many2many_tags"
                       invisible="account_type not in ['asset_receivable', 'liability_payable']"
                       context="{'default_is_company': False}"
                       options="{'no_create': True}"/>
                       
                <!-- Action button for partner assignment -->
                <div class="oe_right" invisible="account_type not in ['asset_receivable', 'liability_payable']">
                    <button name="action_assign_partners" 
                            type="object" 
                            string="Assign Partners" 
                            class="btn-secondary"
                            icon="fa-users"/>
                </div>
            </xpath>
        </field>
    </record>
    
    <!-- Account Account Tree View -->
    <record id="view_account_tree_partner_assignment" model="ir.ui.view">
        <field name="name">account.account.tree.partner.assignment</field>
        <field name="model">account.account</field>
        <field name="inherit_id" ref="account.view_account_list"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='code']" position="after">
                <field name="assigned_partner_ids" 
                       widget="many2many_tags"
                       optional="hide"/>
            </xpath>
        </field>
    </record>
    
    <!-- Separate view for Payable/Receivable Accounts with Partner Assignment -->
    <record id="action_account_receivable_payable_partner_assignment" model="ir.actions.act_window">
        <field name="name">Receivable/Payable Accounts with Partners</field>
        <field name="res_model">account.account</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('account_type', 'in', ['asset_receivable', 'liability_payable'])]</field>
        <field name="context">{'search_default_group_by_account_type': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No receivable or payable accounts found!
            </p>
            <p>
                This view shows receivable and payable accounts where you can assign partners.
                When you assign a partner to an account, their default payable/receivable account
                will be automatically updated.
            </p>
        </field>
    </record>

    <!-- Menu item -->
    <menuitem id="menu_account_partner_assignment"
              name="Partner Account Assignment"
              parent="account.menu_finance_configuration"
              action="action_account_receivable_payable_partner_assignment"
              sequence="25"/>

</odoo>