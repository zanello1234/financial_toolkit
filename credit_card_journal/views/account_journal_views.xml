<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Form view extension with credit card buttons - GUARANTEED TO WORK -->
    <record id="account_journal_form_view_credit_card" model="ir.ui.view">
        <field name="name">account.journal.form.credit.card</field>
        <field name="model">account.journal</field>
        <field name="inherit_id" ref="account.view_account_journal_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='type']" position="after">
                <field name="is_credit_card" string="Is Credit Card" help="Check this box if this is a credit card journal"/>
            </xpath>
            <xpath expr="//field[@name='is_credit_card']" position="after">
                <field name="account_balance" 
                       string="Saldo Cuenta Contable" 
                       widget="monetary"
                       invisible="not is_credit_card"
                       readonly="1"
                       help="Current balance of the default account"/>
            </xpath>
            <xpath expr="//sheet" position="inside">
                <div class="oe_button_box" name="button_box" invisible="not is_credit_card">
                    <button name="action_pay_credit_card" 
                            type="object" 
                            class="oe_stat_button"
                            icon="fa-credit-card"
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;"
                            groups="account.group_account_user"
                            invisible="not is_credit_card">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value">ðŸ’°</span>
                            <span class="o_stat_text">Pagar Tarjeta</span>
                        </div>
                    </button>
                    <button name="action_custom_credit_card_statement" 
                            type="object" 
                            class="oe_stat_button"
                            icon="fa-file-text-o"
                            style="background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); color: white;"
                            groups="account.group_account_user"
                            invisible="not is_credit_card">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value">ðŸ“„</span>
                            <span class="o_stat_text">Resumen</span>
                        </div>
                    </button>
                    <button name="action_view_credit_card_statements" 
                            type="object" 
                            class="oe_stat_button"
                            icon="fa-list"
                            style="background: linear-gradient(135deg, #06B6D4 0%, #8B5CF6 100%); color: white;"
                            groups="account.group_account_user"
                            invisible="not is_credit_card">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value">ðŸ“‹</span>
                            <span class="o_stat_text">Anteriores</span>
                        </div>
                    </button>
                </div>
            </xpath>
        </field>
    </record>

    <!-- Kanban dashboard view - Add credit card buttons to the specific template -->
    <record id="account_journal_kanban_view_credit_card" model="ir.ui.view">
        <field name="name">account.journal.kanban.credit.card</field>
        <field name="model">account.journal</field>
        <field name="inherit_id" ref="account.account_journal_dashboard_kanban_view"/>
        <field name="arch" type="xml">
            <!-- Add is_credit_card field to kanban -->
            <xpath expr="//field[@name='type']" position="after">
                <field name="is_credit_card"/>
                <field name="credit_card_balance"/>
                <field name="account_balance"/>
                <field name="last_closing_date"/>
                <field name="last_due_date"/>
                <field name="currency_id"/>
                <field name="total_to_pay_ars"/>
                <field name="total_to_pay_usd"/>
                <field name="outstanding_consumptions_ars"/>
                <field name="outstanding_consumptions_usd"/>
                <field name="outstanding_payments_ars"/>
                <field name="outstanding_payments_usd"/>
                <field name="default_account_id"/>
            </xpath>
            <!-- Add credit card buttons to JournalBodyBankCash template -->
            <xpath expr="//t[@t-name='JournalBodyBankCash']//div[@name='bank_cash_buttons']" position="after">
                <!-- Currency Information for ALL journals -->
                <div class="mt-1" style="text-align: center; font-size: 12px; color: #666;">
                    <div>
                        <span style="font-weight: bold;">
                            <field name="current_statement_balance" widget="monetary" 
                                   options="{'currency_field': 'currency_id'}"/>
                            (<t t-esc="record.currency_id.value"/>)
                        </span>
                    </div>
                </div>
                
                <!-- Credit Card Section - Only shown if is_credit_card is True -->
                <div class="mt-2 p-2" 
                     style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; text-align: center;"
                     t-if="record.is_credit_card and record.is_credit_card.raw_value">
                    <div class="mb-2">
                        <small style="color: white; font-weight: bold;">ðŸ’³ Saldo Cuenta Contable</small>
                        <div style="color: white; font-size: 14px; font-weight: bold;">
                            <t t-esc="record.account_balance.value"/>
                            <span style="font-size: 11px; color: rgba(255,255,255,0.8);">
                                <t t-esc="record.currency_id.value or 'N/A'"/>
                            </span>
                        </div>
                    </div>
                    
                    <div class="mb-2" style="border-top: 1px solid rgba(255,255,255,0.3); padding-top: 8px;">
                        <small style="color: white; font-weight: bold;">ðŸ’° Balance Calculado</small>
                        <div style="color: white; font-size: 14px; font-weight: bold;">
                            <t t-esc="record.credit_card_balance.value"/>
                            <span style="font-size: 11px; color: rgba(255,255,255,0.8);">
                                <t t-esc="record.currency_id.value or 'N/A'"/>
                            </span>
                        </div>
                    </div>
                    
                    <!-- Payment Totals Section -->
                    <div class="mb-2" style="border-top: 1px solid rgba(255,255,255,0.3); padding-top: 8px;">
                        <small style="color: white; font-weight: bold;">ðŸ“Š Pendientes de Liquidar</small>
                        
                        <!-- Consumos a Liquidar -->
                        <div class="mt-1">
                            <div style="color: rgba(255,255,255,0.9); font-size: 10px; text-align: center;">
                                <strong>ðŸ’³ Consumos:</strong>
                            </div>
                        <div class="row text-center mt-1">
                            <div class="col-6">
                                <div style="color: rgba(255,255,255,0.9); font-size: 11px;">
                                    <strong>ARS:</strong>
                                </div>
                                <div style="color: white; font-size: 12px; font-weight: bold;">
                                    $ <t t-esc="record.outstanding_consumptions_ars.value or '0.00'"/>
                                </div>
                            </div>
                            <div class="col-6">
                                <div style="color: rgba(255,255,255,0.9); font-size: 11px;">
                                    <strong>USD:</strong>
                                </div>
                                <div style="color: white; font-size: 12px; font-weight: bold;">
                                    $ <t t-esc="record.outstanding_consumptions_usd.value or '0.00'"/>
                                </div>
                            </div>
                        </div>
                        </div>
                        
                        <!-- Pagos a Liquidar -->
                        <div class="mt-1">
                            <div style="color: rgba(255,255,255,0.9); font-size: 10px; text-align: center;">
                                <strong>ðŸ’° Pagos:</strong>
                            </div>
                            <div class="row text-center mt-1">
                                <div class="col-6">
                                    <div style="color: rgba(255,255,255,0.9); font-size: 11px;">
                                        <strong>ARS:</strong>
                                    </div>
                                    <div style="color: white; font-size: 12px; font-weight: bold;">
                                        $ <t t-esc="record.outstanding_payments_ars.value or '0.00'"/>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div style="color: rgba(255,255,255,0.9); font-size: 11px;">
                                        <strong>USD:</strong>
                                    </div>
                                    <div style="color: white; font-size: 12px; font-weight: bold;">
                                        $ <t t-esc="record.outstanding_payments_usd.value or '0.00'"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button name="action_pay_credit_card" 
                            type="object" 
                            class="btn btn-light btn-sm me-2"
                            style="font-size: 11px; padding: 4px 8px;"
                            groups="account.group_account_user">
                        ðŸ’° Pagar
                    </button>
                    <button name="action_custom_credit_card_statement" 
                            type="object" 
                            class="btn btn-warning btn-sm me-1"
                            style="font-size: 11px; padding: 4px 8px;"
                            groups="account.group_account_user">
                        ðŸ“„ Resumen
                    </button>
                    <button name="action_view_credit_card_statements" 
                            type="object" 
                            class="btn btn-info btn-sm"
                            style="font-size: 10px; padding: 3px 6px;"
                            groups="account.group_account_user">
                        ðŸ“‹ Anteriores
                    </button>
                    
                    <!-- Credit Card Dates Information -->
                    <div class="mt-2 pt-2" style="border-top: 1px solid rgba(255,255,255,0.3);">
                        <div class="row text-center" style="font-size: 10px; color: rgba(255,255,255,0.9);">
                            <div class="col-6">
                                <div><strong>Ãšltimo Cierre:</strong></div>
                                <div t-if="record.last_closing_date.raw_value">
                                    <t t-esc="record.last_closing_date.value"/>
                                </div>
                                <div t-else="">
                                    <span style="color: rgba(255,255,255,0.6);">No disponible</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div><strong>Ãšltimo Vencimiento:</strong></div>
                                <div t-if="record.last_due_date.raw_value">
                                    <t t-esc="record.last_due_date.value"/>
                                </div>
                                <div t-else="">
                                    <span style="color: rgba(255,255,255,0.6);">No disponible</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </xpath>
        </field>
    </record>

    <!-- Action to show only credit card journals -->
    <record id="action_account_journal_credit_card" model="ir.actions.act_window">
        <field name="name">Credit Card Journals</field>
        <field name="res_model">account.journal</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('type', '=', 'bank')]</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No credit card journals found!
            </p>
            <p>
                Credit card journals help you manage credit card transactions and payments.
                Create a new journal of type "Bank" with "Credit Card" in the name.
            </p>
        </field>
    </record>

</odoo>